<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareQ - Patient Registration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 119, 198, 0.2) 0%, transparent 50%);
            pointer-events: none;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.15),
                0 0 0 1px rgba(255, 255, 255, 0.2);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            position: relative;
            z-index: 1;
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .language-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .language-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #e1e5e9;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .language-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .language-btn:hover {
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #5a6fd8;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .error {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .success {
            color: #27ae60;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .back-link {
            text-align: center;
            margin-top: 20px;
        }

        .back-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .back-link a:hover {
            text-decoration: underline;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e1e5e9;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            font-weight: bold;
            color: #666;
        }

        .step.active {
            background: #667eea;
            color: white;
        }

        .step.completed {
            background: #27ae60;
            color: white;
        }

        .confirmation-step {
            display: none;
        }

        .confirmation-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .confirmation-details h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .confirmation-details p {
            margin-bottom: 8px;
            color: #666;
        }

        .confirmation-buttons {
            display: flex;
            gap: 10px;
        }

        .confirmation-buttons .btn {
            flex: 1;
        }

        .ai-analysis-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            color: white;
        }

        .ai-analysis-section h3 {
            color: white;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3em;
        }

        .ai-analysis-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .ai-insight-item {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4ecdc4;
        }

        .ai-insight-title {
            font-weight: 600;
            color: #4ecdc4;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .ai-insight-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.5;
        }

        .ai-recommendation {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .ai-recommendation-title {
            font-weight: 600;
            color: #4ecdc4;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .ai-recommendation-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .ai-recommendation-list li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
            color: rgba(255, 255, 255, 0.9);
        }

        .ai-recommendation-list li::before {
            content: "‚Ä¢";
            color: #4ecdc4;
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .ai-confidence {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: rgba(78, 205, 196, 0.2);
            border-radius: 8px;
        }

        .ai-confidence-score {
            font-size: 1.2em;
            font-weight: bold;
            color: #4ecdc4;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• CareQ</h1>
            <p id="welcome-text">Welcome! Let's get your token.</p>
        </div>

        <div class="step-indicator">
            <div class="step active" id="step1">1</div>
            <div class="step" id="step2">2</div>
            <div class="step" id="step3">3</div>
        </div>

        <form id="patientForm">
            <!-- Language Selection -->
            <div class="form-group">
                <label>Language / ‡§≠‡§æ‡§∑‡§æ</label>
                <div class="language-selector">
                    <button type="button" class="language-btn active" data-lang="en">English</button>
                    <button type="button" class="language-btn" data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
                </div>
            </div>

            <!-- Step 1: Basic Information -->
            <div id="step1-content">
                <div class="form-group">
                    <label id="age-label">Age</label>
                    <input type="number" id="age" name="age" min="1" max="120" required>
                    <div class="error" id="age-error"></div>
                </div>

                <div class="form-group">
                    <label id="name-label">Full Name</label>
                    <input type="text" id="name" name="name" required>
                    <div class="error" id="name-error"></div>
                </div>

                <button type="button" class="btn" id="next-btn">Next</button>
            </div>

            <!-- Step 2: Symptoms -->
            <div id="step2-content" style="display: none;">
                <div class="form-group">
                    <label id="symptoms-label">Symptoms (separated by commas)</label>
                    <textarea id="symptoms" name="symptoms" placeholder="e.g., fever, cough, headache" required></textarea>
                    <div class="error" id="symptoms-error"></div>
                </div>

                <div class="confirmation-buttons">
                    <button type="button" class="btn btn-secondary" id="back-btn">Back</button>
                    <button type="button" class="btn" id="next-btn-2">Next</button>
                </div>
            </div>

            <!-- Step 3: Confirmation -->
            <div id="step3-content" class="confirmation-step">
                <div class="confirmation-details">
                    <h3 id="confirm-title">Please confirm your details:</h3>
                    <p><strong id="confirm-name-label">Name:</strong> <span id="confirm-name"></span></p>
                    <p><strong id="confirm-age-label">Age:</strong> <span id="confirm-age"></span></p>
                    <p><strong id="confirm-symptoms-label">Symptoms:</strong> <span id="confirm-symptoms"></span></p>
                </div>

                <!-- AI Analysis Section -->
                <div class="ai-analysis-section" id="ai-analysis-section" style="display: none;">
                    <h3 id="ai-analysis-title">ü§ñ AI Health Analysis</h3>
                    <div class="ai-analysis-content" id="ai-analysis-content">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p id="ai-loading-text">Analyzing your symptoms with AI...</p>
                        </div>
                    </div>
                </div>

                <div class="confirmation-buttons">
                    <button type="button" class="btn btn-secondary" id="back-btn-2">Back</button>
                    <button type="button" class="btn btn-primary" onclick="getAIAnalysis()" id="ai-analysis-btn">Get AI Analysis</button>
                    <button type="button" class="btn" id="submit-btn" style="display: none;">Submit</button>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p id="loading-text">Processing your request...</p>
            </div>
        </form>

        <div class="back-link">
            <a href="/admin">‚Üê Back to Admin Dashboard</a>
        </div>
    </div>

    <script>
        const API_URL = "http://127.0.0.1:8000";
        let currentStep = 1;
        let selectedLanguage = 'en';
        let formData = {};

        // Language texts
        const texts = {
            en: {
                welcome: "Welcome! Let's get your token.",
                age: "Age",
                name: "Full Name",
                symptoms: "Symptoms (separated by commas)",
                confirmTitle: "Please confirm your details:",
                confirmName: "Name:",
                confirmAge: "Age:",
                confirmSymptoms: "Symptoms:",
                next: "Next",
                back: "Back",
                submit: "Submit",
                loading: "Processing your request...",
                success: "Success! Your token has been generated.",
                error: "An error occurred. Please try again.",
                invalidAge: "Please enter a valid age (1-120).",
                invalidName: "Please enter your full name.",
                invalidSymptoms: "Please enter at least one symptom."
            },
            hi: {
                welcome: "‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à! ‡§Ü‡§á‡§è ‡§Ü‡§™‡§ï‡§æ ‡§ü‡•ã‡§ï‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§",
                age: "‡§Ü‡§Ø‡•Å",
                name: "‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ",
                symptoms: "‡§≤‡§ï‡•ç‡§∑‡§£ (‡§ï‡•â‡§Æ‡§æ ‡§∏‡•á ‡§Ö‡§≤‡§ó ‡§ï‡§∞‡§ï‡•á)",
                confirmTitle: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç:",
                confirmName: "‡§®‡§æ‡§Æ:",
                confirmAge: "‡§Ü‡§Ø‡•Å:",
                confirmSymptoms: "‡§≤‡§ï‡•ç‡§∑‡§£:",
                next: "‡§Ü‡§ó‡•á",
                back: "‡§µ‡§æ‡§™‡§∏",
                submit: "‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç",
                loading: "‡§Ü‡§™‡§ï‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...",
                success: "‡§∏‡§´‡§≤! ‡§Ü‡§™‡§ï‡§æ ‡§ü‡•ã‡§ï‡§® ‡§ú‡•á‡§®‡§∞‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§",
                error: "‡§è‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
                invalidAge: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡•à‡§ß ‡§Ü‡§Ø‡•Å ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (1-120)‡•§",
                invalidName: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§",
                invalidSymptoms: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§"
            }
        };

        // Initialize the form
        function initForm() {
            updateLanguage();
            setupEventListeners();
        }

        // Update language
        function updateLanguage() {
            const t = texts[selectedLanguage];
            document.getElementById('welcome-text').textContent = t.welcome;
            document.getElementById('age-label').textContent = t.age;
            document.getElementById('name-label').textContent = t.name;
            document.getElementById('symptoms-label').textContent = t.symptoms;
            document.getElementById('confirm-title').textContent = t.confirmTitle;
            document.getElementById('confirm-name-label').textContent = t.confirmName;
            document.getElementById('confirm-age-label').textContent = t.confirmAge;
            document.getElementById('confirm-symptoms-label').textContent = t.confirmSymptoms;
            document.getElementById('next-btn').textContent = t.next;
            document.getElementById('back-btn').textContent = t.back;
            document.getElementById('next-btn-2').textContent = t.next;
            document.getElementById('back-btn-2').textContent = t.back;
            document.getElementById('submit-btn').textContent = t.submit;
            document.getElementById('loading-text').textContent = t.loading;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Language selection
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.language-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedLanguage = this.dataset.lang;
                    updateLanguage();
                });
            });

            // Form navigation
            document.getElementById('next-btn').addEventListener('click', validateStep1);
            document.getElementById('back-btn').addEventListener('click', () => showStep(1));
            document.getElementById('next-btn-2').addEventListener('click', validateStep2);
            document.getElementById('back-btn-2').addEventListener('click', () => showStep(2));
            document.getElementById('submit-btn').addEventListener('click', submitForm);
        }

        // Show specific step
        function showStep(step) {
            // Hide all steps
            document.getElementById('step1-content').style.display = 'none';
            document.getElementById('step2-content').style.display = 'none';
            document.getElementById('step3-content').style.display = 'none';
            document.getElementById('loading').style.display = 'none';

            // Show current step
            if (step === 1) {
                document.getElementById('step1-content').style.display = 'block';
            } else if (step === 2) {
                document.getElementById('step2-content').style.display = 'block';
            } else if (step === 3) {
                document.getElementById('step3-content').style.display = 'block';
            }

            // Update step indicators
            document.querySelectorAll('.step').forEach((stepEl, index) => {
                stepEl.classList.remove('active', 'completed');
                if (index + 1 === step) {
                    stepEl.classList.add('active');
                } else if (index + 1 < step) {
                    stepEl.classList.add('completed');
                }
            });

            currentStep = step;
        }

        // Validate step 1
        function validateStep1() {
            const age = document.getElementById('age').value;
            const name = document.getElementById('name').value;
            const t = texts[selectedLanguage];

            let isValid = true;

            // Clear previous errors
            document.getElementById('age-error').textContent = '';
            document.getElementById('name-error').textContent = '';

            // Validate age
            if (!age || age < 1 || age > 120) {
                document.getElementById('age-error').textContent = t.invalidAge;
                isValid = false;
            }

            // Validate name
            if (!name || name.trim().length < 2) {
                document.getElementById('name-error').textContent = t.invalidName;
                isValid = false;
            }

            if (isValid) {
                formData.age = parseInt(age);
                formData.name = name.trim();
                showStep(2);
            }
        }

        // Validate step 2
        function validateStep2() {
            const symptoms = document.getElementById('symptoms').value;
            const t = texts[selectedLanguage];

            // Clear previous errors
            document.getElementById('symptoms-error').textContent = '';

            // Validate symptoms
            if (!symptoms || symptoms.trim().length < 2) {
                document.getElementById('symptoms-error').textContent = t.invalidSymptoms;
                return;
            }

            // Process symptoms
            const symptomsList = symptoms.split(',').map(s => s.trim()).filter(s => s.length > 0);
            if (symptomsList.length === 0) {
                document.getElementById('symptoms-error').textContent = t.invalidSymptoms;
                return;
            }

            formData.symptoms = symptomsList;
            
            // Update confirmation details
            document.getElementById('confirm-name').textContent = formData.name;
            document.getElementById('confirm-age').textContent = formData.age;
            document.getElementById('confirm-symptoms').textContent = symptomsList.join(', ');
            
            showStep(3);
        }

        // Get AI analysis
        async function getAIAnalysis() {
            const symptoms = document.getElementById('symptoms').value.split(',').map(s => s.trim());
            const age = parseInt(document.getElementById('age').value);
            
            try {
                document.getElementById('ai-analysis-section').style.display = 'block';
                document.getElementById('ai-analysis-btn').style.display = 'none';
                
                const response = await fetch(`${API_URL}/ai/analyze-symptoms`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        symptoms: symptoms,
                        age: age,
                        severity_level: 'Medium'
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    displayAIAnalysis(result);
                    document.getElementById('submit-btn').style.display = 'inline-block';
                } else {
                    throw new Error('AI analysis failed');
                }
            } catch (error) {
                console.error('Error:', error);
                displayAIError();
            }
        }

        // Display AI analysis
        function displayAIAnalysis(data) {
            const container = document.getElementById('ai-analysis-content');
            const analysis = data.ai_analysis;
            const recommendations = data.treatment_recommendations;
            
            container.innerHTML = `
                <div class="ai-insight-item">
                    <div class="ai-insight-title">Potential Conditions</div>
                    <div class="ai-insight-content">${analysis.potential_conditions ? analysis.potential_conditions.join(', ') : 'No specific conditions identified'}</div>
                </div>
                
                <div class="ai-insight-item">
                    <div class="ai-insight-title">Immediate Care</div>
                    <div class="ai-insight-content">${analysis.immediate_care ? analysis.immediate_care.join(', ') : 'Rest and monitor symptoms'}</div>
                </div>
                
                <div class="ai-recommendation">
                    <div class="ai-recommendation-title">Treatment Recommendations</div>
                    <ul class="ai-recommendation-list">
                        ${recommendations.immediate_actions ? recommendations.immediate_actions.map(action => `<li>${action}</li>`).join('') : '<li>Consult with healthcare professional</li>'}
                    </ul>
                </div>
                
                <div class="ai-recommendation">
                    <div class="ai-recommendation-title">Lifestyle Changes</div>
                    <ul class="ai-recommendation-list">
                        ${recommendations.lifestyle_changes ? recommendations.lifestyle_changes.map(change => `<li>${change}</li>`).join('') : '<li>Maintain healthy lifestyle</li>'}
                    </ul>
                </div>
                
                <div class="ai-confidence">
                    <div>AI Confidence Score</div>
                    <div class="ai-confidence-score">${Math.round(analysis.confidence_level * 100)}%</div>
                </div>
                
                <div class="ai-insight-item">
                    <div class="ai-insight-title">Important Note</div>
                    <div class="ai-insight-content">This AI analysis is for informational purposes only. Please consult with healthcare professionals for proper medical advice and treatment.</div>
                </div>
            `;
        }

        // Display AI error
        function displayAIError() {
            const container = document.getElementById('ai-analysis-content');
            container.innerHTML = `
                <div class="ai-insight-item">
                    <div class="ai-insight-title">AI Analysis Unavailable</div>
                    <div class="ai-insight-content">AI analysis is temporarily unavailable. You can still proceed with registration and consult with healthcare professionals.</div>
                </div>
            `;
            document.getElementById('submit-btn').style.display = 'inline-block';
        }

        // Submit form
        async function submitForm() {
            const t = texts[selectedLanguage];
            
            // Show loading
            showStep(4); // This will show loading
            document.getElementById('loading').style.display = 'block';

            try {
                const response = await fetch(`${API_URL}/patients/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: Math.floor(Math.random() * 1000000), // Generate random ID for web users
                        name: formData.name,
                        age: formData.age,
                        symptoms: formData.symptoms,
                        lang_code: selectedLanguage
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    showSuccess(result);
                } else {
                    throw new Error('Failed to submit');
                }
            } catch (error) {
                console.error('Error:', error);
                showError(t.error);
            }
        }

        // Show success page
        function showSuccess(result) {
            const t = texts[selectedLanguage];
            document.getElementById('loading').innerHTML = `
                <div style="text-align: center; color: #27ae60;">
                    <div style="font-size: 3em; margin-bottom: 20px;">‚úÖ</div>
                    <h2 style="color: #27ae60; margin-bottom: 20px;">${t.success}</h2>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <p><strong>Token Number:</strong> ${result.id}</p>
                        <p><strong>Estimated Wait Time:</strong> ${result.eta} minutes</p>
                        <p><strong>Severity Level:</strong> ${result.severity}</p>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn" onclick="downloadPDF(${result.id})" style="margin-right: 10px;">Download PDF</button>
                        <button class="btn btn-secondary" onclick="location.reload()">Register Another Patient</button>
                    </div>
                </div>
            `;
        }

        // Show error
        function showError(message) {
            document.getElementById('loading').innerHTML = `
                <div style="text-align: center; color: #e74c3c;">
                    <div style="font-size: 3em; margin-bottom: 20px;">‚ùå</div>
                    <h2 style="color: #e74c3c; margin-bottom: 20px;">Error</h2>
                    <p>${message}</p>
                    <button class="btn" onclick="location.reload()" style="margin-top: 20px;">Try Again</button>
                </div>
            `;
        }

        // Download PDF
        async function downloadPDF(patientId) {
            try {
                const response = await fetch(`${API_URL}/generate_token_pdf/${patientId}`);
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `token_${patientId}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } else {
                    alert('Failed to download PDF');
                }
            } catch (error) {
                console.error('Error downloading PDF:', error);
                alert('Error downloading PDF');
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initForm);
    </script>
</body>
</html>
